# שימחוקלוק – שרת לוגיסטי

מסמך זה מסכם את המצב הנוכחי של שרת ההפצה, וכן מפרט מה צפוי להתווסף בהמשך הדרך לפי סיפורי המשתמש המלאים.

## מה קיים כרגע

השרת כתוב ב-Node.js עם Express ומתחבר ל-PostgreSQL (מחרוזת חיבור ב-`DATABASE_URL`). הוא מספק שכבת API שמחזירה נתונים ממבטי-דוחות קיימים ומאפשרת ניהול מלאי, הזמנות ורכישות חריגות.

### נקודות קצה עיקריות

- **בריאות**: `GET /health` – בדיקת חיים בסיסית של השירות.
- **דוחות לוגיסטיים** (`/api/logistics`):
  - `GET /daily` – דוח יומי מורחב עם אפשרות סינון לפי סטטוס (`final_status`).
  - `GET /risk60d` – פריטים בסיכון לחוסר מלאי ב-60 הימים הקרובים.
  - `GET /reorder` – המלצות הזמנה מחדש לפי סדרי עדיפויות.
- **ניהול חריגי מדיניות** (`/api/overrides`):
  - `POST /` – יצירת חריגה חדשה לרמות מלאי/כמות הזמנה, כולל ניטרול חריגות פעילות קודמות לאותו מוצר.
  - `PATCH /:id/disable` – ביטול חריגה קיימת.
- **הזמנות רכש** (`/api/purchase-orders`):
  - `GET /` – רשימת 200 הזמנות אחרונות.
  - `POST /` – יצירת הזמנת רכש חדשה עם סטטוס ראשוני `ORDERED`.
- **עדכון מלאי** (`/api/inventory`):
  - `PATCH /:productId` – עדכון/שמירת רמות מלאי (`on_hand`, `reserved`, `in_transit`) עם upsert וחותמת זמן עדכנית.

### תלויות והרצה

1. הגדרת משתנה סביבה `DATABASE_URL` עם מחרוזת חיבור ל-PostgreSQL.
2. הפעלה בפיתוח: `npm run dev` (דורש `ts-node-dev`).
3. בנייה: `npm run build`, הפעלה לאחר בנייה: `npm start`.

## מה צפוי/אפשרי להתווסף בהמשך

בהתאם לסיפורי המשתמש המלאים, הגרסה העתידית של המערכת צפויה לכלול:

- **מנהל מכירות**
  - הצעת מלאי מותאמת לחנות לפי היסטוריית רכישות ותקציב, עם הגבלת המלצה ל-15% מתקציב החנות.
  - טיפול בחנויות חדשות באמצעות המלצה המבוססת על "הנמכרים ביותר".
  - סינון דגמים שנרכשו ב-30 הימים האחרונים כדי למנוע כפילויות מלאי.
- **מנהל שיווק**
  - דו"ח שבועי לפוטנציאל הרחבת מותג שמזהה חנויות עם פער מותגים מעל 30% מהממוצע האזורי.
  - נימוק דמוגרפי אוטומטי להצעת ההשקה.
  - כלי ניהול קמפיין כולל ייצוא פרטי קשר של בעלי החנויות.
- **מנהל לוגיסטיקה**
  - דו"ח יומי לחיזוי חסרים ומלאי מת על בסיס מכירות של שלושה חודשים.
  - חיזוי מתקדם שמסמן פריטים שיגיעו לרמת מלאי קריטית בתוך 60 יום (כולל מקדם עונתיות) ושיקוף זמן אספקה (Lead Time).
  - זיהוי מלאי מת עבור פריטים שקצב המכירה שלהם ירד ב-40–60%.
- **בעל החנות (לקוח קצה)**
  - אזור אישי להצגת הצעת המלאי, אישור/דחייה ועריכת כמויות.
  - חישוב סל דינמי בזמן אמת, איסוף סיבת דחייה מחייבת ובדיקת מסגרת אשראי עם חסימת אישור במקרה חריגה.

תוספות אלו יתמכו במטרה הכוללת של שיפור הרווחיות, זיהוי פערי שוק, ייעול לוגיסטי ושיפור חוויית הלקוח.
